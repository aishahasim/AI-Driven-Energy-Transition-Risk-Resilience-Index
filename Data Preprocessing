!pip install xgboost shap statsmodels
import kagglehub

# Download latest version
path = kagglehub.dataset_download("pralabhpoudel/world-energy-consumption")

print("Path to dataset files:", path)
import os

os.listdir(path)
import pandas as pd

df = pd.read_csv(f"{path}/World Energy Consumption.csv")

print("Shape:", df.shape)
df.head()
df.info()
print(df.columns)
print(df.index)
# Drop exact duplicates
df = df.drop_duplicates()

# Ensure correct types
df["year"] = df["year"].astype(int)
df["country"] = df["country"].astype(str)

print("Shape after deduplication:", df.shape)
focus_countries = [
    "Saudi Arabia",
    "United States",
    "China",
    "Germany",
    "United Kingdom",
    "India"
]

df = df[df["country"].isin(focus_countries)].copy()
print("Shape after country filter:", df.shape)

missing_ratio = df.isna().mean()

keep_cols = missing_ratio[missing_ratio < 0.7].index.tolist()
df = df[keep_cols]

print("Remaining columns:", len(df.columns))

[c for c in df.columns if "co2" in c.lower()]

df["renewable_share"] = (
    df["renewables_consumption"] / df["primary_energy_consumption"]
)

df["fossil_share"] = (
    df["fossil_fuel_consumption"] / df["primary_energy_consumption"]
)

df["energy_diversification"] = (
    df["renewables_consumption"] /
    (df["coal_consumption"] + df["oil_consumption"] + df["gas_consumption"])
)

df["energy_per_capita"] = (
    df["primary_energy_consumption"] / df["population"]
)

model_features = [
    "renewable_share",
    "fossil_share",
    "energy_diversification",
    "energy_per_capita",
    "gdp",
    "population",
    "coal_consumption",
    "oil_consumption",
    "gas_consumption"
]

df_model = df[["country", "year"] + model_features].copy()
df_model.shape

df_model = df_model.sort_values(["country", "year"])

train = df_model[df_model["year"] <= 2015]
test  = df_model[df_model["year"] > 2015]

X_train = train.drop(columns=["country", "year", "renewable_share"])
y_train = train["renewable_share"]

X_test = test.drop(columns=["country", "year", "renewable_share"])
y_test = test["renewable_share"]

df_model.shape

target = "fossil_share"

df_model.columns.tolist()

target = "fossil_share"
assert target in df_model.columns

X = df_model.drop(columns=[target, "country"])
y = df_model[target]

# Drop rows where target is missing
df_model = df_model.dropna(subset=[target])

# Separate features and target
X = df_model.drop(columns=[target])
y = df_model[target]


# HARD SAFETY CHECK â€” remove any non-numeric columns
X = X.select_dtypes(include=["number"])

# Sanity check
X.dtypes.unique()
